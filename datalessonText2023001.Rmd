---
title: "2023年研修"
author: "福田俊介"
date: "2023/01/31"
output:
  pdf_document:
    latex_engine: xelatex
    number_sections: true
    toc: true
    toc_depth: 2
documentclass: bxjsarticle
classoption: xelatex,ja=standard
indent: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

if (knitr::opts_knit$get("rmarkdown.pandoc.to") %in% c("beamer", "latex")) {

  options(device = function(file, width = 7, height = 7, ...) {
    cairo_pdf(tempfile(), width = width, height = height, ...)
  })
  
  knitr::opts_chunk$set(dev="cairo_pdf", dev.args=list(family="ipa"))
}

```

\newpage


```{r include=FALSE}
#データの準備
library(tidyverse)
library(reti)
library(retiex)

osaka <- reti::reti_read_LO("csvdata/27_Osaka Prefecture_20053_20222.csv")
```

# はじめに

不動産鑑定士の目線での**取引事例**は、
取引事例比較法を適用する場合に用いる資料であり、
各々の取引事例は、
地域の特性と個別性を持つ**個別の不動産の個別の価格**を示す資料です。
そして、不動産鑑定士は、
一つ一つの事例を念入りに見ることにはとても慣れていると思います。

しかしながら一方で、通常の鑑定評価の作業で、
**複数の取引事例を分析する**ということは
あまり行っていないのではないでしょうか？
複数の取引事例とは、
幅広いデータの集まりだと「〇〇市の全ての住宅地域」の取引事例であったり、
実務上で具体的にありそうな例であれば
「３年以内で枚方市内の牧野駅を最寄り駅とする、
土地面積が60㎡から130㎡までの住宅地域に掛かる取引全ての事例」などです。

例えば、REAネットの事例閲覧ページで、
自分の好きな検索条件を設定した結果の一覧をイメージしてください。
不動産鑑定士は、通常の業務経験の積み重ねから、
これら事例検索結果の一覧をざっと一瞥することで、
町名や字名、価格の偏り、最寄り駅からの距離、前面道路の幅員や系統から
対象不動産の存する近隣地域との優劣比較を行い、
近隣地域の価格水準の見当を大まかにつけてしまいます。

このような複数の事例に対して鑑定士が行っている処理は、
普段から鑑定士がこうした作業を
繰り返し業務として行っていることによる経験に基づく
専門性の高いものであると思っています。
ですから一方で、このような作業自体を
不動産鑑定士以外の人へ分かりやすく説明するということは、
なかなか難しい部分だったりすると思います。

そこで、このテキストでは、
一般的なデータ分析による**複数データの分析の仕方**を利用して、
鑑定評価上の**複数の事例**の分析の仕方を
一般の人（鑑定士以外の人）に説明する際のヒントを紹介しようと思います。
もちろん、**複数データの分析**の知識自体が、
鑑定士自身の複数事例に対する分析の精緻化にも寄与すると思います。


## 利用しているデータ

```{r include=FALSE}
# データの件数
how_many_osaka <- nrow(osaka)

# 含まれるデータ年の範囲
osaka_year_range <- range(osaka$t_year)
```


まず、この文書で用いている**複数のデータ**は、
国土交通省が公表している不動産取引価格情報から、
大阪府の土地のみの取引に掛かるデータ
（`r osaka_year_range[1]`年から`r osaka_year_range[2]`年までの
`r style_yen(how_many_osaka,unit="件")`
）
をベースにしています。


https://www.land.mlit.go.jp/webland/servlet/MainServlet


各項目では、このデータから特定の条件で抜き出したデータを用いています。


\newpage



# 複数データをみる視点


```{r include=FALSE}
# 最新年にかかる寝屋川市の住宅地データ
neyagawa <- osaka %>% 
  reti_filter_by_city("寝屋川市") %>% 
  reti_filter_by_kind("R")

hirakata <- osaka %>% 
  reti_filter_by_city("枚方市") %>% 
  reti_filter_by_kind("R")

# データの件数
how_many_neyagawa <- nrow(neyagawa)
neyagawa_mean <- mean(neyagawa$`土地単価`)
```



ここから複数データとして、
大阪府の**寝屋川市の住宅地に掛かる土地取引の取引単価（㎡単価）**を扱って行きます。
ここでまず、**複数のデータ**と具体的にどんな向き合い方が出来るのかを考えていきましょう。

不動産のことを考える時、鑑定士目線では（私がそうなのですが）、
何か個別の不動産を価格を求めるための思考回路がすぐに働いてしまいます。
すなわち、個別性や地域性の異なるものが混じった複数事例全体をみることの意味が
いまいちピンとこないかもしれません。

## 複数データの具体的イメージとしての地域の地価水準

そこで、ここでは、
**複数や全体を具体的にイメージするために 「寝屋川市の住宅地域の地価水準」**
というものを考察することを考えてみてください。

もし、先生方が普段REA事例を利用して、
或る市に掛かる事例を「住宅地域」という括りだけで検索すると、
すごく沢山の事例が検索結果として表示されることが容易に想像できると思います。
実際に寝屋川市の住宅地に掛かる事例の件数を数えると
`r style_yen(how_many_neyagawa, unit ="件") `あります。
当然、１ページにおさまる件数ではありません。
単純にページを切り替えて全体に目を通したとしても
土地単価全データの傾向的なものを把握することは
困難であることが予想できます。


では、そもそも、地域の特性等の類似性で検索して、
データの数を絞り、見通しのよい状態になった検索画面では、
私達は何を見ているのでしょうか？
直感的に思うのは「どの辺りの数字が多いのか」ではないでしょうか。
例えば、ざっとみて㎡単価11万円や12万円程度の事例が**多そう**だなぁ
という感覚です。

一方で、ここでみるような目視で把握困難な大量のデータを目の前にすると、
何が「多そう」なのかを把握しづらくなります。
そこで、感覚的に「多そう」と感じている部分をもう
少し精緻化する方法を検討しましょう。

\newpage






# 複数データの中の多いものを把握するという視点

何が多くて何が少ないかは、
単純に「数えて、その数えた数字で比較する」ことで簡単に把握することが出来ます。
例えば、「単価11万円台の事例が何件、単価12万円台の事例が何件、、、」という
具合に一つ一つの事例を単価何万円台なのかに分けて、その数を数えます。

先に、「簡単に把握することが出来ます。」と書きましたが、
ここでの事例のデータ数は`r style_yen(how_many_neyagawa, unit ="件") `あり、
**自分で一つづつ集計するのは簡単ではありません**。
そのためには、この集計を行うシステムが必要です。
しかし、この
**集計さえ行ってしまえば、複数のデータを把握するのが簡単**
になるという視点をまずは把握しましょう。


## 区間毎に集計する

さて、ここでは具体的な数字を見るために実際に、
１万円台毎の数をプログラム的に数えてみます。


```{r echo=FALSE}
# R言語によるプログラムのコードの参考

# 1万円毎に区分した階級ごとの集計
cut(neyagawa$`土地単価`, breaks = seq(0, 500000, 10000)) %>% 
  table()
```

上記で示されている集計結果の表現は、
ある区間毎に該当する件数が何件あるかを表現しています。

この出力書式は、数学やデータを表す表現の方法で割と一般的なものなので、
この機会に見慣れておきましょう。

まず、 (1e+04,2e+04] と書かれている部分は、
10,000より大きく、20,000以下の区間ということを表しています。
括弧が間違って印刷されていたり、数字が文字化けしているわけではありません。

まず、区間を表す場合、「〇〇より大きい」や「〇〇以下」という表現があるように、
何かをきちんと分析する場合、
そこで表示されている数字を「含む」、「含まない」ということを正確に表現する必要があります。
そして、一般的（数学やデータ分析等の分野）には、
区間の表現で値を含まないものを **開区間** 、値を含むものを **閉区間** と呼んでいます。
そして、具体的にこれを文字で表現する場合に、
開区間を丸括弧である"("で、閉区間を角括弧"["で表現します。

次に、1e+04 の部分は、桁数が大きい数字をコンパクトに表す表現として、
一般的に使われる表現です。
これは、"e"の後ろに、10の何乗かという数字を書いて表現します。
ですから 1e+04 は、$1 \times 10^4$つまり 10,000 を表しています。

最後に、これら区間を表す表記の下に書かれた数字がその区間にある事例数を表現しています。


## 具体的な数字を得る

このように、集計すると**具体的な数字**を得ることが出来ます。
例えば、このデータの集計を見ると (9e+04,1.1e+05]、すなわち、㎡単価が9万円より大きく10万円以下の区間の事例が
最も多く130件あるという事が正確にわかります。
そして、(1e+05,1.1e+05]、すなわち、
㎡単価が10万円より大きく11万円以下の区間の事例は 111 件であり、
(1.1e+05,1.2e+05]、すなわち、
㎡単価が11万円より大きく12万円以下の区間の事例は 119 件であます。

この微妙な違いに意味があるかどうかの判断は別として、
一覧をざっと見て多そうな数字を感覚的に把握するのと、
実際に数えて具体的な数字で見比べるのとの違いが把握できると思います。

また、これらの集計を自分でどうやるのか？という点については、
今の所、気にしなくて結構です。
沢山のデータについては、ある区間ごとに集計して数えることで
具体的な数字として得られる情報があるという事をまずは把握しましょう。


## 平均値とそれ以外の視点

ここで、大量のデータについて、
簡単に数えたり計算できたりするのであれば、
複数データを代表する数値として最も有名な**平均値**を調べて、
それを一つの目安とすることも可能でしょう。

寝屋川市のデータの平均値は`r style_yen(neyagawa_mean, unit="円/㎡")`です。
先程の最も多い区間と比べると、
平均値の表す数字のある区間とは異なっていることがわかります。

この様に複数のデータを扱う場合、
「平均値」はその複数のデータの性質を表す目安のうちの
**一つ**であり、複数データを分析して得られる数字は他にも沢山あるのです。
つまりは、複数データの平均値が常に「正しい」何かを表しているわけではなく、
複数のデータを考察する際には、他にも色々な視点があるのです。

\newpage




# 複数データに見られるデータの偏り

さて、ここまでは**複数データ**から、
「多そう」な部分を見つけるために区間毎の集計を行い、
「最も多い区間」を見つけました。

ここで、もともと考察しようと思っているのは
「寝屋川市の住宅地域の価格水準」です。
もちろん、「最も多い区間」イコール「当該地域の価格水準」と判断するのも一つの方法です。

しかし、今、私達は、具体的に数え上げた各区間の事例数が手元にあり、
先に見たとおり、例えば、㎡単価10万円より大きくて、
14万円以下の１万円毎の各区間についても100件以上の事例があります。
単純に1万円刻みの区間に決定するよりも、
これら周辺の多そうな部分も含めることにも合理性が有りそうです。
その一方で、㎡単価が30万円を超えるような事例は、ほとんどありません。

このように、複数のデータを考察して具体的に集計を行うと、
もちろん「多そう」な部分の中から正確に「最も多い」部分を見つけることが出来るのですが、
それ以外に、データ全体について、
どの範囲にどれくらいの量の事例が**分布**しているのかを知ることができるので、
多そうだと思える範囲と、逆にこれは無さそうと思える範囲などの
**程度**を自分の物差しで判断できるようになります。


この程度を直感的に把握するには、先に見たどの区間に何件の事例があるという
具体的な数字をみるだけではピンと来ません。
実は、この分布からそれぞれの区間の多い少ないの程度を把握するには
グラフで見る方が直感的にわかりやすくなります。
そこで、実際に上述の集計表を可視化したものが次のグラフになります。


```{r echo=FALSE}
# ヒストグラムの描画
#hist(neyagawa$`土地単価`)
neyagawa %>% 
  ggplot() + 
  #geom_histogram(mapping = aes(x = `土地単価`), binwidth = 100000) + 
  geom_histogram(mapping = aes(x = `土地単価`), breaks =  seq(0, 500000, 10000))+
  #coord_cartesian(xlim = c(0,500000))+
  ggtitle("土地単価のヒストグラム") +
  scale_x_continuous(labels =
                       function(v){
                         retiex::style_yen(v, 0, "円/㎡")
                       }
  )

```


このグラフは**ヒストグラム**と呼ばれるグラフです。
このグラフの横軸は㎡単価が書かれており、
棒状のグラフの横幅がその**区間**を表し、
棒の高さで区間にある事例の数を表しています。
棒の高さや区間の具体的な数字は、先の集計表のものです。


まずはじめに一般的にデータを分析する上で、
**ヒストグラム**という単語を覚えます。
そして、**ヒストグラム**と**棒グラフ**は異なるものであることを認識します。

普段耳にする「グラフ」と呼んでいるもの、
例えば、棒グラフ、円グラフ、折れ線グラフ、帯グラフ等は、
見た目の違いで、「〇〇グラフ」と認識していると思います。
形的に言えば、「ヒストグラム」も「棒グラフ」も大体同じです。
しかし、データ分析を行っている文脈で「ヒストグラム」というグラフが出てくると、
先にやったように
「あるデータを区間毎に集計して、その数量を表示している」グラフを指しています。
つまり、形のことを言っているのではなくて、
そのグラフが表している意味が付随しています。
日常生活で使わえる**グラフ**は、
何かのデータを**見やすく**するために使われる事が多いですが、
データ分析で使われる**グラフには意味**があるということを認識しましょう。



## 山形をしたヒストグラム

さて、ヒストグラムの形を眺めると「山形」になっています。
つまり、最も事例が多くあつまるような或る区間があり、
その一番多い区間から離れる程にその区間に存する事例数が減っていくという事を表しています。

なにかの物事を集計すると、
大体この様に多い部分と少ない部分の**偏りがあるように分布**していて、
可視化すると山形になっていることが多いのです。

我々はこのことを理由のあるなしは別としてなんとなく経験則的に知っているので、
一番はじめに「寝屋川市の住宅地域の価格水準」を知る上で、
「多そう」な価格から話を始めた事にそれほど違和感を感じなかったので
はないでしょうか？

## ヒストグラムと設定する区間

さて、実は区間集計をとったり、
それに基づいたヒストグラムというグラフを描くとき、
**区間**をどの様に取るかで、その得られる結果が異なります。
先の分析では、単価1万円台毎に集計を取りましたが、
これを単価2万円台毎の集計でやった場合の結果を以下に示します。


```{r echo=FALSE}
# R言語によるプログラムのコードの参考

# 1万円毎に区分した階級ごとの集計
cut(neyagawa$`土地単価`, breaks = seq(0, 500000, 20000)) %>% 
  table()
```


これに基づいたヒストグラムは以下のとおりになります。


```{r echo=FALSE}
# ヒストグラムの描画
#hist(neyagawa$`土地単価`)
neyagawa %>% 
  ggplot() + 
  #geom_histogram(mapping = aes(x = `土地単価`), binwidth = 100000) + 
  geom_histogram(mapping = aes(x = `土地単価`), breaks =  seq(0, 500000, 20000))+
  #coord_cartesian(xlim = c(0,500000))+
  ggtitle("土地単価のヒストグラム") +
  scale_x_continuous(labels =
                       function(v){
                         retiex::style_yen(v, 0, "円/㎡")
                       }
  )

```


このように、区間のとり方によりその集計結果が変わるのは当たり前のことですが、
例えば、１万円台毎の集計のときは、10万円／㎡以下の部分でピークがあったのに、
２万円台の集計のときは10万円／㎡以上の部分にピークがあります。

このとき、「どっちが多いの？」と頭を悩ませることになるかもしれません。
これは、**「どちらかが正しい」というものでは無く**、
はじめに書いたとおり**「区間のとり方によりその集計結果は変わる」**のです。


## 分布の形状に着目する確率密度曲線

さて、もともと、沢山の事例の中から「多そう」な部分を知るために、
区間設定をおこない、それに該当する事例の数を数えて集計し、
その集計結果をヒストグラムで描き**分布**の状態を知りました。

しかし、区間設定による集計では、
その区間のとり方により、ヒストグラムの形状が変わってしまいました。

そこで、分布の様子を考察する時、
いつでも同じデータなら同じ形状になるように可視化するグラフがあります。
これは、区間ごとの集計を行うのではなく、全事例に対する、
その値までの事例の個数の割合を面積として表示するグラフで**確率密度曲線**と呼ばれています。


```{r echo=FALSE}
# ヒストグラムの描画
#hist(neyagawa$`土地単価`)
neyagawa %>% 
  ggplot() + 
  geom_density(mapping = aes(x = `土地単価`))+
  ggtitle("土地単価の確率密度曲線") +
  scale_x_continuous(labels =
                       function(v){
                         retiex::style_yen(v, 0, "円/㎡")
                       }
  )

```

この**確率密度曲線**というグラフの名前もデータ分析でよく出てくる名前なので、
まずは、まずは、名前を覚えてしまいましょう。
はじめは、このグラフをどうやって描くかのかという**書き方**は気にせず、
**確率密度曲線は、データの分布の様子を表している**ということを
把握していれば十分です。
分布を考察する時にヒストグラムのように区間設定が必要なく、
同じデータに対して同じ結果が得られます。



```{r include=FALSE}
neya_max <- neyagawa$`土地単価` %>% max() %>% style_yen(unit = "円／㎡")
neya_min <- neyagawa$`土地単価` %>% min() %>% style_yen(unit = "円／㎡")
```

\newpage



# 分布を複数データの性質としてみる

ここまでで、「寝屋川市の住宅地域の価格水準」を検討することを目的として
複数の事例データを考察するために「多そう」な部分に着目することから初め、
データが分布している様子を見れるようになりました。
ここからは、
この分布仕方がひとまとまりの複数データの性質を表すものだと考え、
分布を考察する時どのようなところに着目できるのかを見ていきましょう。
つまり、
**分布の性質を紐解くことで、「寝屋川市の住宅地域の価格水準」に接近する**わけです。


## 最大と最小

いままでは、直感的に **多そう** な部分に着目していましたが、
今度は逆に **無さそう** な部分に着目してみましょう。
つまり、複数データの中に含まれる最大値と最小値です。
寝屋川市での土地単価の最大値は`r neya_max`であり
土地単価の最小値は`r neya_min`です。

現実の取引での可能性は別として、
得られている事例の中では最大値より大きな、
また、最小値より小さな取引はなかったという事実が得られます。
つまりは、この範囲の外側での取引は**無さそう**な領域として把握できます。
このことを考えると最大値、最小値も**分布の性質**を表す一つの重要な要素と言えます。


## データの集中、ばらつきの具合

今まで、寝屋川市の住宅地域だけを見ていましたが、
一つのデータを見るだけでなく、茨木市の住宅地域のデータを**比較**してみましょう。


```{r echo=FALSE}
iba_neya <- osaka %>% 
  reti_filter_by_city(c("茨木市","寝屋川市")) %>% 
  reti_filter_by_kind("R")

# ヒストグラムの描画
#hist(neyagawa$`土地単価`)
iba_neya %>% 
  ggplot() + 
  geom_density(mapping = aes(x = `土地単価`, color = `市名`))+
  ggtitle("土地単価の確率密度曲線の比較") +
  scale_x_continuous(labels =
                       function(v){
                         retiex::style_yen(v, 0, "円/㎡")
                       }
  )

```


上のグラフは寝屋川市と茨木市の住宅地の単価の確率密度曲線です。

## 確率密度曲線の縦軸の高さが表すもの

複数の事柄を確率密度曲線で比較する際に**注意が必要**なのは、
縦軸が取引の絶対量を表しているのではないということです。
つまり、このグラフでは、
寝屋川市のほうが茨木市より**取引の量が多いわけではありません**。

このグラフでは、寝屋川市のグラフのピークは、横軸12万円／㎡前後の地点です。
また、茨木市のピークは横軸で20万円／㎡強の地点です。
そして、ピーク時の縦軸は何を表しているかというと、
寝屋川市の全事例のうちの12万円台の事例の割合であり、
つまり、そこに**集中している度合い**を表しています。

これに対して、茨木市の20万円／㎡強の地点のピークの高さが
寝屋川市よりも低くなっています。
これは、茨木市が寝屋川市ほど、価格の**偏りが集中していない**。
すなわち、寝屋川市と**比較して価格がバラけている**ということを表しています。

あらためて、確率密度曲線を見ると、
寝屋川市は比較的データが集中しているので山が**のっぽ**であり、
茨木市は比較的データがバラけているので山が**なだらか**になっています。


このように、複数のデータがある場合、
そのデータの**集中度合いやバラけ具合が、そのデータの分布の特徴の一つ**になります。

\newpage


# 四分位を使ってデータのばらつき具合を考察

複数データを考察する視点の一つとして
「ばらつき具合」があることがわかってきました。
ただ、先の項目では可視化されたグラフで、
直感的に高い低いを把握しただけです。
ここから、これをもう少し精緻に考察する方法を考えます。

## 最大値と最小値

先に見た最大値と最小値です。
そして、先にも言ったとおり、
これが複数データの端っこであり、バラけている限界を表しています。

## 中央値

```{r include=FALSE}
ans_str <- ""
if (how_many_neyagawa %% 2 == 1) {
 num <- (how_many_neyagawa + 1) / 2
 ans_str <- paste0(style_yen(num,unit = "件目"),"の値")
}else{
 num <- how_many_neyagawa / 2
 ans_str <- paste0(style_yen(num,unit = "件目"), "と", style_yen(num+1,unit = "件目"),"の平均値")
  
}

ans_str
```


中央値は文字通り、真ん中の値です(全データ数が偶数の場合は、真ん中２件の平均値)。
具体的には、寝屋川市の事例は`r style_yen(how_many_neyagawa,unit="件")`なので、
事例を小さい方から順番に並べて`r ans_str`になります。

この真ん中の値が分かると、ここから最大値までの差と最小値までの差が異なる場合、
データの集まり具合がどっち側に偏っているのかを知ることが出来ます。


## 四分位数

さて、最小、中央、最大の値を具体的に得ることで、
分布の偏り具合を考察出来そうに思えてきました。
しかし、もう少し細やかに把握するためにデータ分析の世界では
**最小と真ん中の真ん中、すなわち25%位置**と
**真ん中と最大の真ん中、すなわち75%位置**の数値も把握します。
全体のデータの区間を４つに分割することから**四分位**と呼ばれています。
第１四分位は、最小と中央の真ん中。第３四分位は、中央と最大の真ん中になります。
（第２四分位は中央値、第４四分位は最大値に一致するので通常そのように呼びません）

```{r include=FALSE}
iba <- osaka %>% 
  reti_filter_by_city(c("茨木市")) %>% 
  reti_filter_by_kind("R")



neya_q1 <- summary(neyagawa$`土地単価`)[2] %>% style_yen(unit = "円／㎡")
neya_q2 <- summary(neyagawa$`土地単価`)[3] %>% style_yen(unit = "円／㎡")
neya_q3 <- summary(neyagawa$`土地単価`)[5] %>% style_yen(unit = "円／㎡")

iba_min <- summary(iba$`土地単価`)[1] %>% style_yen(unit = "円／㎡")
iba_q1 <- summary(iba$`土地単価`)[2] %>% style_yen(unit = "円／㎡")
iba_q2 <- summary(iba$`土地単価`)[3] %>% style_yen(unit = "円／㎡")
iba_q3 <- summary(iba$`土地単価`)[5] %>% style_yen(unit = "円／㎡")
iba_max <- summary(iba$`土地単価`)[6] %>% style_yen(unit = "円／㎡")

summary(iba$`土地単価`)

```

|寝屋川市の四分位数|
|---|---|
|最小値|`r neya_min`|
|第1四分位|`r neya_q1`|
|中央位|`r neya_q2`|
|第3四分位|`r neya_q3`|
|最大値|`r neya_max`|



## 箱ひげ図

前の項目では四分位数を具体的な数値でみました。
この数値を視覚化して相対的な位置関係を直感的に把握できるようにしましょう。
この四分位の位置関係を可視化したグラフを**箱ひげ図**と呼びます。
以下に、寝屋川市の住宅地域の土地単価データの箱ひげ図を示します。


```{r echo=FALSE}

# ヒストグラムの描画
#hist(neyagawa$`土地単価`)
neyagawa %>% 
  ggplot() + 
  geom_boxplot(mapping = aes(y = `土地単価`,x = `市名`),coef = 2)+
  ggtitle("寝屋川市の土地単価の箱ひげ図") +
  scale_y_continuous(labels =
                       function(v){
                         retiex::style_yen(v, 0, "円/㎡")
                       }
  )

```

大きなコマのような形が表されています。
コマ本体の長方形の部分の真ん中に太い横線が書かれていますが、
**この太い線が中央値**の位置です。

次に、コマ本体の長方形の**下側の辺の位置が第1四分位**の位置です。
逆に、コマ本体の長方形の**上側の辺の位置が第3四分位**の位置です。

更に、コマから突き出した上下にひげの様な線が突き出ています。
まず、下側は線の終端が最小値の位置を表しています。
次に、上側には、線が突き出し、その線の先に点がいくつか書かれています。
この点の中で一番上にある点が最大値の位置を表しています。

この線は最大で第１四分位から第３四分位までの距離の1.5倍の位置まで引かれ、
それを超えた部分のデータは点で表示されるようになっています。


### 箱ひげ図の見方

まず、箱ひげ図は基本的にコマ本体の長方形部分にデータ全体の
50%のデータがあることを示しています。
ですから、コマの長方形部分が上下に大きく太い場合、相対的にデータがバラけており、
コマの長方形部分が上下に小さく薄い場合、
相対的にデータが集中してまとまりがあると把握できます。

次に、ひげ及び点の部分は、データ内によく見られるデータから、
離れた部分にあるデータで、その離れ具合を表しています。
特に、点で表示される部分は、
そのデータ群の中で飛び抜けて離れたデータを示しており、
不動産の土地単価であれば、
何らかの著しい事情があることが予測されるべきデータの存在を把握することが出来ます。


### 箱ひげ図で比較する

相対的な位置関係は比較することで明らかになるものがあります。
茨木市と寝屋川市の箱ひげ図を並べてみてみます。
あわせて、具体的な数値もそのあとに示します。

```{r echo=FALSE}
iba_neya <- osaka %>% 
  reti_filter_by_city(c("茨木市","寝屋川市")) %>% 
  reti_filter_by_kind("R")

# ヒストグラムの描画
#hist(neyagawa$`土地単価`)
iba_neya %>% 
  ggplot() + 
  geom_boxplot(mapping = aes(y = `土地単価`, x = `市名`))+
  ggtitle("土地単価の確率密度曲線の比較") +
  scale_y_continuous(labels =
                       function(v){
                         retiex::style_yen(v, 0, "円/㎡")
                       }
  )

```


|寝屋川市の四分位数|
|---|---|
|最小値|`r neya_min`|
|第1四分位|`r neya_q1`|
|中央位|`r neya_q2`|
|第3四分位|`r neya_q3`|
|最大値|`r neya_max`|


|茨城市の四分位数|
|---|---|
|最小値|`r iba_min`|
|第1四分位|`r iba_q1`|
|中央位|`r iba_q2`|
|第3四分位|`r iba_q3`|
|最大値|`r iba_max`|


\newpage

# 複数のデータからみる価格の水準

複数のデータの代表値である**平均**を
価格水準の数値として採用することも一つの方法です。

しかし、ここで見てきたように、複数のデータを考察する際の視点として、
複数のデータがどの様な分布の状態にあるのかを把握し、
それらの特徴を示す数値を用いて価格水準を説明することも一つの方法です。

具体的には、上記で求めた四分位数値を参考に、
寝屋川市の住宅地域の取引では、`r neya_q1`から`r neya_q3`の価格帯が主である
ということに数値的な裏付けをもたらすことが出来ます。






